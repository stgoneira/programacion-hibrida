<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Unidad 2 - Programación Híbrida</title>

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/reset.min.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/reveal.min.css" />
		
		<!-- otros themes: https://revealjs.com/themes/ Ejemplos: black, white, league, beige, sky, night, serif, simple, solarized, blood, moon -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/theme/white.min.css" />
		<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/theme/blood.min.css" /> -->

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/highlight/monokai.min.css" />
		
		<link rel="stylesheet" href="estilo.css" />
		
		<!-- plugin notación matemática -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/math/math.min.js"></script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-separator="^---$" data-separator-vertical="^===$" data-separator-notes="^Note:" data-markdown data-line-numbers>
    				<textarea data-template>
## [Unidad 2 (Parte 2)](#)
### Programación Híbrida
	
---
## [Temas - Parte 2](#)	
- Routing
- Validaciones
- Mejoras diseño
- SQLite
- Preferencias
- Ejecución en Android


---
## [Routing](#)

- Angular Router hace posible la navegación entre páginas en Ionic 
- La configuración de las rutas está en el archivo [app.routes.ts](#)

===
## [Routing](#)
<iframe width="560" height="315" src="https://www.youtube.com/embed/_pnptBPkreo?si=Zboy7FpjeINhDnH7"  allowfullscreen></iframe>

---
## [Validaciones](#)

- Recordemos que existen 2 tipos de formularios
- Y por ende, 2 tipos de validaciones 
- Para template-driven forms 
- Y para formularios reactivos 

===
## [Mejoras de diseño](#)

<iframe width="560" height="315" src="https://www.youtube.com/embed/c4Z4VKxDBP8?si=3tkt1vItpZNckdP3"  allowfullscreen></iframe>

===
## [Validaciones](#)

<iframe width="560" height="315" src="https://www.youtube.com/embed/EGwxIeHSWzo?si=EvJ9dN6BQYw-M_nF"  allowfullscreen></iframe>

---
## [Mejoras Diseño Lista Productos](#)

<iframe width="560" height="315" src="https://www.youtube.com/embed/hVLP4japPeM?si=CK74mF9Gzo2-_Pod"  allowfullscreen></iframe>

---
## [SQLite en Ionic](#)

- Existe un plugin para usar SQLite en entornos: Web, iOS y Android
- Se llama [@capacitor-community/sqlite](https://github.com/capacitor-community/sqlite)
- Para entornos Web requiere usar jeep-sqlite
- jeep-sqlite está creado con Stencil

===
## [Dependencias - SQLite](#)

```bash
npm i @capacitor-community/sqlite
```

===
## [Web - SQLite](#)

- Para entornos Web se requieren de pasos adicionales:
	- Copiar [nodes_modules/sql.js/dist/sql-wasm.wasm](#) a [src/assets](#)
	- Editar archivo [main.ts](#)
	- Editar AppComponent
	- Código de inicialización especial 

===
## [MAIN.TS - SQLite](#)

Editar archivo [main.ts](#)
```typescript[2,8]
// otras importaciones
import { defineCustomElements } from 'jeep-sqlite/loader'

if (environment.production) {
  enableProdMode();
}

defineCustomElements(window)

// más código
```

===
## [AppComponent - SQLite](#)

Se añade la propiedad schemas
```typescript[1,9]
import { Component, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { IonApp, IonRouterOutlet } from '@ionic/angular/standalone';

@Component({
  selector: 'app-root',
  templateUrl: 'app.component.html',
  standalone: true,
  imports: [IonApp, IonRouterOutlet], 
  schemas: [CUSTOM_ELEMENTS_SCHEMA]
})
export class AppComponent {
  constructor() {}
}

```

===
## [AppComponent - SQLite](#)

Uso etiqueta [jeep-sqlite](#)
```xml[3]
<ion-app>
  <ion-router-outlet></ion-router-outlet>
  <jeep-sqlite autoSave="true"></jeep-sqlite>  
</ion-app>
```

===
## [Web - SQLite](#)

Ejemplo de inicialización para entorno web:
```typescript
private async _iniciarPluginWeb(): Promise<void> {    
	await customElements.whenDefined('jeep-sqlite')
	const jeepSqliteEl = document.querySelector("jeep-sqlite")
	if( jeepSqliteEl != null ) {      
	  await this.sqlite.initWebStore()            
	}
}
```

===
## [Init - SQLite](#)

Inicialización del plugin y creación de tablas si no existiesen:
```typescript
async iniciarPlugin() {    
	this.plataforma = Capacitor.getPlatform()
	if(this.plataforma == "web") {
	  await this._iniciarPluginWeb()
	}
	await this.abrirConexion()
	await this.db.execute(this.DB_SQL_TABLAS)             
}
```

===
## [Conexión - SQLite](#)

```typescript
async abrirConexion() {                    
	const ret = await this.sqlite.checkConnectionsConsistency() 
	const isConn = (await this.sqlite.isConnection(this.DB_NAME, this.DB_READ_ONLY)).result
	if(ret.result && isConn) {
	  this.db = await this.sqlite.retrieveConnection(this.DB_NAME, this.DB_READ_ONLY)      
	} else {
	  this.db = await this.sqlite.createConnection(
		this.DB_NAME,
		this.DB_ENCRIPTADA,
		this.DB_MODE,
		this.DB_VERSION,
		this.DB_READ_ONLY
	  )
	}
	await this.db.open()
}
```

===
## [SQL - SQLite](#)

```typescript
async getProductos():Promise<Producto[]> {    
	const sql = `SELECT * FROM ${this.DB_TABLE_NAME}`      
	const resultado = await this.db.query(sql)
	return resultado?.values ?? []
}
async agregarProducto(p:Producto):Promise<void> {    
	const sql = `INSERT INTO ${this.DB_TABLE_NAME}(${this.DB_COL_PROD}, ${this.DB_COL_COMP}) VALUES(?, ?)`
	await this.db.run(sql, [p.nombre, p.comprado])    
}
```

===
## [Ejemplo - SQLite](#)

<iframe width="560" height="315" src="https://www.youtube.com/embed/gCqOIEUiGOQ?si=eJDurjwe7svKyK36"  allowfullscreen></iframe>

---
## [Preferences](#)

- Es un plugin nativo de CapacitorJS
- Permite almacenar strings en formato [clave-valor](#)
- Es muy sencillo de utilizar
- La documentación está en: https://ionicframework.com/docs/native/preferences

===
## [Instalación - Preferences](#)

```bash
npm install @capacitor/preferences
npx cap sync
```

===
## [Ejemplos - Preferences](#)

```typescript
import { Preferences } from '@capacitor/preferences'

await Preferences.set({
	key: "ORDENAR_ALFABETICAMENTE", 
	value: "true"
})
```

===
## [Ejemplos - Preferences](#)

```typescript
import { Preferences } from '@capacitor/preferences'

const deboOrdenar = await Preferences.get({
	key: "ORDENAR_ALFABETICAMENTE"
})
```

===
## [Video - Preferences](#)



---
## [Plataforma Android](#)

- Es posible exportar el proyecto de Ionic para que corra en Android
- Las aplicaciones son manejadas a través de [Android Studio](https://developer.android.com/studio)
- Requiere la instalación del IDE y la SDK 
- Puedes correr las aplicaciones en un teléfono o emulador 
- https://capacitorjs.com/docs/android

===
## [Instalación - Android Studio](#)

===
## [Video - Android](#)


				    </textarea>
				</section>
			</div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/reveal.min.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/notes/notes.min.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/markdown/markdown.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/highlight/highlight.min.js"></script>
		<script>			
			Reveal.initialize({
				hash: true,
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.KaTeX ]
			});
			Reveal.on('ready', e => {
				// e.previousSlide, e.currentSlide, e.indexh, e.indexv 				
				const claseSlide = `slide-${e.indexh}-${e.indexv}`
				document.body.className = `reveal-viewport ${claseSlide}`
			});
			Reveal.on('slidechanged', e => {
				// e.previousSlide, e.currentSlide, e.indexh, e.indexv 				
				const claseSlide = `slide-${e.indexh}-${e.indexv}`
				document.body.className = `reveal-viewport ${claseSlide}`
			});
		</script>
	</body>
</html>
